<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.farmer.fruit.persistence.review.IReviewDao" >
  <resultMap id="BaseResultMap" type="com.farmer.fruit.models.review.Review" >
    <id column="id" property="id"  />
    <result column="user_id" property="userId"  />
    <result column="content" property="content" />
    <result column="score" property="score"  />
    <result column="user_ip" property="userIp" />
    <result column="replay_flag" property="replayFlag"  />
    <result column="fruit_code" property="fruitCode" />
    <result column="farmer_id" property="farmerId" />
    <result column="star_level" property="starLevel" />
    <result column="delete_flag" property="deleteFlag" />
    <result column="create_time" property="createTime"/>
    <result column="update_time" property="updateTime"/>

  </resultMap>

  <sql id="Base_Column_List" >
    id,user_id,user_mobile,content,score,user_ip,replay_flag,fruit_code,farmer_id,star_level,create_time,delete_flag,update_time
  </sql>
  <sql id="condition">
    <where>
      <if test="farmerId !=null">
        and farmer_id = #{farmerId}
      </if>
      <if test="deleteFlag !=null">
        and delete_falg = #{deleteFlag}
      </if>
    </where>
  </sql>
  <select id="findList" parameterType="ReviewQuery" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List"/>
    FROM qr_review r
    <include refid="condition"/>
    order by create_time desc
    limit #{pageNo}, #{pageSize}
  </select>

  <select id="getTotalCount" parameterType="ReviewQuery" resultType="java.lang.Integer">
    select count(1) from qr_review r
    <include refid="condition"/>
  </select>

  <insert id="insert" useGeneratedKeys="true" keyProperty="id" parameterType="Review">
    <selectKey resultType="java.lang.Long" order="AFTER" keyProperty="id">
      SELECT LAST_INSERT_ID() AS id
    </selectKey>
    insert into qr_review
    (user_id,user_mobile,content,score,user_ip,replay_flag,fruit_code,farmer_id,star_level,create_time,delete_flag)
    values
    ({user_id},#{user_mobile},#{content},#{score},#{user_ip},#{replay_flag},#{fruit_code},#{farmer_id},#{star_level},#{create_time},#{delete_flag})

  </insert>

  <update id="update" parameterType="Review">
    update qr_review
      <set>
        <if test="deleteFlag !=null">
          delete_flag = #{deleteFlag}
        </if>
      </set>
    where id = #{id}
  </update>
</mapper>