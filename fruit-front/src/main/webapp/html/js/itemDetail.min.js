/*! wgroup - v1.0.0 - 2016-07-21 */
"use strict";
function getMoreWgroupItem() {
    $.ajax({
        url: "http://wxt.360haoyao.com/info/getMore.action", type: "post", dataType: "html", success: function (a) {
            null !== a && "" !== a && ($("#moreItem").html(a), moreSlider())
        }
    })
}
function moreSlider() {
    $("#moreGroup ul li").each(function (a, b) {
        $("#sliderPosMore").append('<a href="javascript:window.homeSwipe.slide(' + a + ', 400) ;"></a>')
    }), $("#sliderPosMore a").eq(0).addClass("on");
    var a = !1;
    2 === $("#slider li").length && (a = !0), window.homeSwipe = new Swipe(document.getElementById("moreGroup"), {
        startSlide: 0,
        speed: 400,
        auto: 3e3,
        continuous: !0,
        disableScroll: !1,
        stopPropagation: !1,
        callback: function (b, c) {
            $("#sliderPosMore a.on").removeClass("on"), a && (b %= 2), $("#sliderPosMore").find("a").eq(b).addClass("on")
        },
        transitionEnd: function (a, b) {
        }
    })
}
function gotoPay(a) {
    var b = $(a).attr("data-id"), c = $("#itemType").val();
    return 2 != c || window.browserInfo.isClient ? void(window.location = "http://wx.360haoyao.com/wgroup/order/checkOrder.action?wgroup_id=" + b) : (document.getElementById("appTips").style.display = "block", document.body.style.overflow = "hidden", !1)
}
function changeOptName(a) {
    2 === a ? $("#optname").html("�δ��ʼ") : 0 === a ? $("#optname").html("�ȴ��齱") : 3 === a && $("#optname").html("�鿴�н�����")
}
function gotoDrawList() {
    window.location.href = "http://wx.360haoyao.com/info/getDrawList.action?wgroupId=" + g_item_date.wgroupId
}
function getDrawType() {
    $.ajax({
        url: "http://wxt.360haoyao.com/info/getDrawType.action",
        type: "post",
        data: {wgroupId: g_item_date.wgroupId},
        dataType: "json"
    }).done(function (a) {
        if ("SUCCESS" == a.FLAG) {
            var b = parseInt(a.DATA);
            changeOptName(b), 3 === b ? ($("#optFunction").attr("onclick", "gotoDrawList()"), $(".groupPrice a").attr("href", "#")) : 0 === b ? ($("#optFunction").removeAttr("onclick"), $(".groupPrice a").attr("href", "http://wx.360haoyao.com/info/getDrawList.action?wgroupId=" + g_item_date.wgroupId), $(".groupPrice a").eq(1).html("�н�<br>����")) : 2 === b ? ($("#optFunction").removeAttr("onclick"), $(".groupPrice a").eq(1).html("����<br>�ڴ�"), a.drawStartTime && renderDrawTime({
                endTime: a.drawStartTime,
                currentTime: a.currentTime
            }, b)) : (g_isOver || getMore.init(), a.drawEndTime && renderDrawTime({
                endTime: a.drawEndTime,
                currentTime: a.currentTime
            }, b))
        }
    }).fail(function () {
        g_isOver || getMore.init()
    })
}
function renderDrawTime(a, b) {
    var c = "";
    if ($("#drawCountdown").length <= 0) {
        switch (b) {
            case 2:
                c = '<div class="notesBox"><div class="groupFail"><span>����ʼ��ʣ��</span><span id="drawCountdown"><i>xx:xx:xx</i></span><span>�����ĵȴ�Ŷ</span></div></div>';
                break;
            case 1:
                c = '<div class="notesBox"><div class="groupFail"><span>��������ʣ��</span><span id="drawCountdown"><i>xx:xx:xx</i></span><span>�뾡������Ŷ</span></div></div>'
        }
        $(".goodsDetail").append(c)
    }
    $("#drawCountdown").length > 0 && (gDrawCountdown.endTime = new Date(a.endTime).getTime(), gDrawCountdown.currentTime = new Date(a.currentTime).getTime(), gDrawCountdown.init(b))
}
var g_item_date = {
    wgroupId: parseInt($("#optFunction").attr("data-id")),
    manualtype: parseInt($("#manualtype").val()),
    showReadyGroup: !0
}, checkHeight = function () {
    window.iScroll && Math.abs(this.y) > $(".groupPrice").offset().top + 140 ? $(".groupFixed").show() : $("body").scrollTop() > $(".groupPrice").offset().top + 140 ? $(".groupFixed").show() : $(".groupFixed").hide()
}, getShare = {
    shareObj: {
        title: document.title,
        desc: $("meta[name=description]").attr("content"),
        link: window.location.href.split("#")[0] + "?tracker_u=" + g_tracker_u + "&tcpos1=wxshare&sharefrom=wxt",
        imgUrl: $(".slideList").find("img").attr("src")
    }, init: function () {
        var a = this;
        a.getShareData()
    }, getShareData: function () {
        $.ajax({
            url: "http://wx.360haoyao.com/wx/getConfigJsonp.action",
            type: "GET",
            dataType: "jsonp",
            callback: "callback",
            jsonpcallback: "configCallback" + (new Date).getTime(),
            data: {url: window.location.href.split("#")[0]}
        }).done(function (a) {
            "false" === a.success || a.success === !1 || (a.data.jsApiList = ["onMenuShareTimeline", "onMenuShareAppMessage", "onMenuShareQQ", "onMenuShareQZone"], wx.config(a.data), wx.ready(function () {
                getShare.shareObj.link = getShare.shareObj.link + "_wx", wx.onMenuShareAppMessage(getShare.shareObj), wx.onMenuShareTimeline(getShare.shareObj), wx.onMenuShareQQ(getShare.shareObj), wx.onMenuShareQZone(getShare.shareObj)
            }))
        }).fail(function () {
        })
    }
}, itemCountdown = {
    timeLoop: !1, init: function () {
        var a = itemCountdown;
        a.timeLoop && window.clearTimeout(a.timeLoop), a.start()
    }, start: function () {
        var a = itemCountdown;
        $(".groupMore-time").each(function (b, c) {
            var d = parseInt($(c).attr("data-endTime")), e = parseInt($(c).attr("data-currentTime")), f = d - e;
            if (f <= 0)return void a.end(c);
            var g = getFormatTime(f, 2);
            $(c).html(g), $(c).attr("data-currentTime", e + 100)
        }), a.timeLoop = window.setTimeout(function () {
            itemCountdown.init()
        }, 100)
    }, end: function (a) {
        $(a).html("00:00:00")
    }
}, getMore = {
    init: function () {
        var a = this;
        a.getMoreData()
    }, getMoreData: function () {
        g_item_date.showReadyGroup && $.ajax({
            url: "http://wx.360haoyao.com/info/getRecommendGroupJsonp.action?",
            type: "GET",
            dataType: "jsonp",
            callback: "callback",
            jsonpcallback: "moreCallback" + (new Date).getTime(),
            data: {wgroupId: $("#wgroupId").val()}
        }).done(function (a) {
            a.recommendList && getMore.renderMoreList(a.recommendList)
        }).fail(function () {
        })
    }, renderMoreList: function (a) {
        var b = $("<div>");
        b.addClass("groupMore"), b.html('<div class="groupMore-title">����С��鼴�����ţ�������ֱ�Ӳ���</div><div class="groupMore-list" id="groupMore-list"></div>'), $(".groupExplain").before(b);
        for (var c = 0; c < a.length; c++) {
            var d = a[c], e = "";
            0 === parseInt(d.needsNum) || (e = '<a class="groupMore-item" href="http://wx.360haoyao.com/wgroup/order/orderDetail.action?pinOrderId=' + d.pinId + '"><span class="groupMore-img"><img src="' + d.ownerPic + '" alt=""></span><div class="groupMore-info"><span class="groupMore-text">��ʣ<i class="groupMore-time" data-currentTime="' + d.currentTime + '" data-endTime="' + d.endTime + '"></i>����,��ʣ<i>' + d.needsNum + '</i>��</span></div><div class="redBtn groupMore-Link">��������<i></i></div></a>', $("#groupMore-list").append(e))
        }
        getMore.renderCountdown()
    }, renderCountdown: function () {
        itemCountdown.init()
    }
};
$(function () {
    getShare.init(), getMoreWgroupItem(), $("#slider li").each(function (a, b) {
        $("#sliderPos").append('<a href="javascript:window.itemSwipe.slide(' + a + ', 400) ;"></a>')
    }), $("#sliderPos a").eq(0).addClass("on");
    var a = !1;
    2 === $("#slider li").length && (a = !0), $("#appTips").length > 0 && $("#appTips").on("click", ".modal-close", function (a) {
        a.preventDefault(), document.getElementById("appTips").style.display = "none", document.body.style.overflow = "auto"
    }), function () {
        window.itemSwipe = new Swipe(document.getElementById("slider"), {
            startSlide: 0,
            speed: 400,
            auto: 3e3,
            continuous: !0,
            disableScroll: !1,
            stopPropagation: !1,
            callback: function (b, c) {
                $("#sliderPos a.on").removeClass("on"), a && (b %= 2), $("#sliderPos").find("a").eq(b).addClass("on")
            },
            transitionEnd: function (a, b) {
            }
        }), $("img").on("load", function (a) {
            a.preventDefault()
        }), window.iScroll ? (window.iScroll.on("scroll", checkHeight), $(".pageTop").on("click", function (a) {
            a.preventDefault(), window.iScroll.scrollTo(0, 0, 200)
        })) : ($(window).on("scroll", function (a) {
            a.preventDefault(), checkHeight()
        }), $(".pageTop").on("click", function (a) {
            a.preventDefault(), $("body").scrollTop(0)
        })), $.ajax({
            url: "http://wx.360haoyao.com/info/getStockAndStatus.action",
            type: "GET",
            dataType: "jsonp",
            callback: "callback",
            jsonpcallback: "stockCallback" + (new Date).getTime(),
            data: {wgroup_id: $("#wgroupId").val(), itemId: $("#itemId").val()}
        }).done(function (a) {
            var b = $("#manualtype").val();
            1 != a.flag || 2 != a.status && "1" != b || a.stock <= 0 && "1" != b ? ($(".groupPrice").addClass("soldOut").removeClass("hidden"), $(".doneSpan").show(), $(".groupPrice a").attr("href", "#"), g_item_date.showReadyGroup = !1) : $(".groupPrice").removeClass("hidden"), 1 == g_item_date.manualtype ? getDrawType() : g_isOver || getMore.init()
        }).fail(function () {
            $(".groupPrice").addClass("soldOut").removeClass("hidden"), $(".groupPrice a").attr("href", "#")
        })
    }(), callAppFunc("appShowShareButton", {showShare: !0});
    var b = getCookie("shareType");
    if (b)switch (b) {
        case"wxt_wxhaoyou":
            $("#appTips .downBtn").attr("href", "http://t.360haoyao.com/QFBzeu"), $("#floatBanner .open").attr("href", "http://t.360haoyao.com/aQ3YNj");
            break;
        case"wxt_pengyouquan":
            $("#appTips .downBtn").attr("href", "http://t.360haoyao.com/VZniim"), $("#floatBanner .open").attr("href", "http://t.360haoyao.com/FBfmea");
            break;
        case"wxt_xinlang":
            $("#appTips .downBtn").attr("href", "http://t.360haoyao.com/nIRbyu"), $("#floatBanner .open").attr("href", "http://t.360haoyao.com/aqY7Vf");
            break;
        case"wxt_qq":
            $("#appTips .downBtn").attr("href", "http://t.360haoyao.com/yE7Bja"), $("#floatBanner .open").attr("href", "http://t.360haoyao.com/MZnuum");
            break;
        case"wxt_wx":
            $("#appTips .downBtn").attr("href", "http://t.360haoyao.com/3queMr"), $("#floatBanner .open").attr("href", "http://t.360haoyao.com/7Nr63e")
    } else $("#appTips .downBtn").attr("href", "http://t.360haoyao.com/vMZNVz"), $("#floatBanner .open").attr("href", "http://t.360haoyao.com/3Ije63")
});
var gDrawCountdown = {
    endTime: 0, currentTime: 0, timeLoop: !1, init: function (a) {
        var b = gDrawCountdown, c = parseInt(gDrawCountdown.endTime) - parseInt(gDrawCountdown.currentTime);
        b.timeLoop && window.clearTimeout(b.timeLoop), c <= 0 ? b.end(a) : b.start(c)
    }, start: function (a) {
        var b = gDrawCountdown, c = getFormatTime(a, 2);
        $("#drawCountdown").html("<i>" + c + "</i>"), gDrawCountdown.endTime = gDrawCountdown.endTime - 1e3, b.timeLoop = window.setTimeout(function () {
            gDrawCountdown.init()
        }, 1e3)
    }, end: function (a) {
        2 == a ? getDrawType() : $("#drawCountdown").parent().html("�˴γ齱��ѽ�����")
    }
};
//# sourceMappingURL=itemDetail.min.js.map